<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Compute a matching table between two lists of municipality IDs — swc_get_mapping • SwissCommunes</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Compute a matching table between two lists of municipality IDs — swc_get_mapping" />
<meta property="og:description" content="For two lists of Swiss municipality IDs at any two points in time, this
function creates a data frame with two columns where each row represents
a match between municipality IDs.  This can be used as an intermediate
table for merging two data sets with municipality identifiers taken at
different, possibly unknown, points in time." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



<!-- dependencies from examples -->


  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SwissCommunes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.8.9005</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/data.html">Mapping tables as CSV files</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/cynkra/SwissCommunes/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute a matching table between two lists of municipality IDs</h1>
    <small class="dont-index">Source: <a href='https://github.com/cynkra/SwissCommunes/blob/master/R/swc_get_mapping.R'><code>R/swc_get_mapping.R</code></a></small>
    <div class="hidden name"><code>swc_get_mapping.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>For two lists of Swiss municipality IDs at any two points in time, this
function creates a data frame with two columns where each row represents
a match between municipality IDs.  This can be used as an intermediate
table for merging two data sets with municipality identifiers taken at
different, possibly unknown, points in time.</p>
    </div>

    <pre class="usage"><span class='fu'>swc_get_mapping</span><span class='op'>(</span><span class='va'>ids_from</span>, <span class='va'>ids_to</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>ids_from</th>
      <td><p>A list of "source" municipality IDs, preferably a factor</p></td>
    </tr>
    <tr>
      <th>ids_to</th>
      <td><p>A list of "target" municipality IDs, preferably a factor</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data frame with columns prefixed by <code>from.</code> and <code>to</code> that
  represents the computed match.  The municipality IDs are stored in the
  columns <code>from.mId</code> and <code>to.mId</code>.  The columns
  <code>from.MergeType</code> and <code>to.MergeType</code> contain <code>valid</code> if
  the municipality is contained in both the input and the mapping table,
  <code>missing</code> if the municipality is missing from the input, and
  <code>extra</code> if the municipality is in the input but not in the mapping
  table; most columns are <code>NA</code> for such rows.  In addition, the column
  <code>MergeType</code> offers a summary of the "from" and "to" status: Rows with
  values other than <code>"valid"</code> or <code>"missing"</code> should be examined.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>It is advisable to use factors as list of municipality IDs.  By that,
comparisons and merges for municipality IDs are automatically checked for
compatibility.</p>
<p>Note that the "from" list must be from an earlier time than the "to" list.
Trying to compute the mapping the other way round results in an error.
This is intentional: As municipalities are usually merged, it makes sense
to use the most recent data set as target for the mapping.  This can also be
a file with suitable geometries to allow for visualization.</p>

<p>For two lists of municipalities, we construct a mapping from the first list
to the second.  First, the most probable mutation number in the
"municipality mutations" data set is computed.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: ‘dplyr’</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:stats’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    filter, lag</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:base’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    intersect, setdiff, setequal, union</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>SwissPop</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>SwissBirths</span><span class='op'>)</span>

<span class='co'># Show mismatch of municipality IDs:</span>
<span class='va'>ids_from</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>SwissPop</span>, <span class='va'>MunicipalityID</span><span class='op'>)</span>
<span class='va'>ids_to</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>SwissBirths</span>, <span class='va'>MunicipalityID</span><span class='op'>)</span>
<span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='va'>ids_from</span>, <span class='va'>ids_to</span><span class='op'>)</span>
</div><div class='output co'>#&gt;   [1] "327"  "328"  "330"  "343"  "384"  "531"  "601"  "618"  "621"  "752" 
#&gt;  [11] "753"  "851"  "854"  "862"  "864"  "882"  "887"  "926"  "933"  "974" 
#&gt;  [21] "984"  "986"  "994"  "1027" "1028" "1029" "1034" "1035" "1036" "1038"
#&gt;  [31] "1042" "1060" "1087" "1090" "1101" "1105" "1106" "1124" "1133" "1134"
#&gt;  [41] "1141" "1144" "1148" "1149" "1601" "1602" "1603" "1604" "1605" "1606"
#&gt;  [51] "1607" "1608" "1609" "1610" "1611" "1612" "1613" "1614" "1615" "1616"
#&gt;  [61] "1617" "1618" "1619" "1620" "1621" "1622" "1623" "1624" "1625" "1626"
#&gt;  [71] "1627" "1628" "1629" "2001" "2002" "2003" "2007" "2012" "2017" "2018"
#&gt;  [81] "2020" "2023" "2026" "2031" "2032" "2036" "2037" "2042" "2046" "2062"
#&gt;  [91] "2064" "2069" "2070" "2071" "2074" "2075" "2077" "2081" "2082" "2083"
#&gt; [101] "2085" "2088" "2091" "2092" "2093" "2094" "2095" "2100" "2101" "2103"
#&gt; [111] "2105" "2107" "2108" "2109" "2110" "2112" "2132" "2133" "2136" "2139"
#&gt; [121] "2141" "2142" "2144" "2146" "2150" "2151" "2154" "2156" "2158" "2159"
#&gt; [131] "2161" "2176" "2180" "2181" "2182" "2188" "2190" "2191" "2202" "2203"
#&gt; [141] "2204" "2210" "2214" "2215" "2219" "2227" "2229" "2232" "2241" "2247"
#&gt; [151] "2253" "2263" "2269" "2282" "2322" "2324" "2326" "2327" "2329" "2330"
#&gt; [161] "2331" "2332" "2443" "2447" "2460" "2494" "2496" "2531" "2552" "2905"
#&gt; [171] "2911" "2912" "2913" "2916" "2918" "2934" "3335" "3336" "3351" "3354"
#&gt; [181] "3355" "3357" "3371" "3376" "3406" "3523" "3573" "3591" "3600" "3601"
#&gt; [191] "3602" "3632" "3639" "3641" "3642" "3664" "3665" "3666" "3667" "3692"
#&gt; [201] "3702" "3704" "3706" "3709" "3710" "3771" "3773" "3774" "3775" "3776"
#&gt; [211] "3841" "3842" "3843" "3844" "3845" "3846" "3892" "3912" "3913" "3914"
#&gt; [221] "3915" "3928" "3930" "3942" "3943" "3944" "3971" "3973" "3984" "4011"
#&gt; [231] "4036" "4043" "4070" "4101" "4116" "4118" "4162" "4168" "4171" "4174"
#&gt; [241] "4178" "4180" "4225" "4278" "5011" "5016" "5031" "5032" "5033" "5034"
#&gt; [251] "5035" "5036" "5037" "5038" "5039" "5040" "5041" "5042" "5043" "5044"
#&gt; [261] "5045" "5046" "5047" "5062" "5065" "5066" "5067" "5068" "5069" "5070"
#&gt; [271] "5074" "5075" "5080" "5092" "5093" "5094" "5098" "5101" "5104" "5106"
#&gt; [281] "5107" "5110" "5111" "5114" "5116" "5122" "5123" "5127" "5128" "5134"
#&gt; [291] "5142" "5145" "5147" "5150" "5153" "5156" "5158" "5159" "5164" "5165"
#&gt; [301] "5168" "5169" "5175" "5177" "5179" "5182" "5183" "5184" "5185" "5188"
#&gt; [311] "5190" "5191" "5201" "5204" "5209" "5211" "5215" "5217" "5218" "5220"
#&gt; [321] "5223" "5228" "5232" "5234" "5235" "5241" "5244" "5245" "5246" "5247"
#&gt; [331] "5248" "5252" "5256" "5258" "5259" "5262" "5264" "5265" "5267" "5301"
#&gt; [341] "5302" "5303" "5305" "5306" "5308" "5311" "5312" "5313" "5314" "5316"
#&gt; [351] "5318" "5319" "5320" "5321" "5322" "5433" "5452" "5453" "5454" "5455"
#&gt; [361] "5457" "5459" "5460" "5461" "5462" "5463" "5517" "5519" "5524" "5525"
#&gt; [371] "5526" "5528" "5532" "5536" "5538" "5558" "5567" "5569" "5570" "5602"
#&gt; [381] "5603" "5605" "5608" "5612" "5630" "5641" "5647" "5677" "5681" "5687"
#&gt; [391] "5691" "5781" "5783" "5784" "5786" "5787" "5793" "5794" "5795" "5796"
#&gt; [401] "5797" "5800" "5801" "5802" "5811" "5814" "5815" "5818" "5820" "5823"
#&gt; [411] "5824" "5825" "5826" "5829" "5901" "5916" "5917" "5918" "5920" "5927"
#&gt; [421] "5936" "6051" "6059" "6060" "6062" "6063" "6065" "6066" "6067" "6070"
#&gt; [431] "6071" "6085" "6086" "6088" "6103" "6107" "6174" "6175" "6176" "6179"
#&gt; [441] "6180" "6196" "6200" "6231" "6233" "6237" "6245" "6247" "6251" "6457"
#&gt; [451] "6460" "6501" "6502" "6503" "6505" "6506" "6507" "6508" "6509" "6510"
#&gt; [461] "6746" "6747" "6749" "6752" "6755" "6756" "6772" "6777" "6779" "6780"
#&gt; [471] "6786" "6788" "6791" "6794" "6795" "6796" "6797" "6798" "6799" "6801"
#&gt; [481] "6802" "6804" "6805"</div><div class='input'><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='va'>ids_to</span>, <span class='va'>ids_from</span><span class='op'>)</span>
</div><div class='output co'>#&gt;  [1] "632"  "756"  "855"  "888"  "948"  "1151" "1630" "1631" "1632" "2050"
#&gt; [11] "2051" "2052" "2114" "2115" "2116" "2162" "2233" "2234" "2235" "2337"
#&gt; [21] "2338" "2503" "3340" "3358" "3359" "3378" "3617" "3671" "3713" "3792"
#&gt; [31] "3847" "3931" "3932" "3955" "4049" "4184" "5048" "5049" "5050" "5137"
#&gt; [41] "5138" "5236" "5237" "5238" "5269" "5323" "5324" "5397" "5398" "5464"
#&gt; [51] "5540" "5541" "5571" "5613" "5804" "5805" "5831" "6074" "6075" "6076"
#&gt; [61] "6090" "6118" "6181" "6203" "6204" "6252" "6461" "6512" "6807" "6808"
#&gt; [71] "6809" "6810"</div><div class='input'>
<span class='co'># Compute mapping and count non-matching municipality IDs:</span>
<span class='va'>mapping</span> <span class='op'>&lt;-</span> <span class='fu'>swc_get_mapping</span><span class='op'>(</span>ids_from<span class='op'>=</span><span class='va'>ids_from</span>, ids_to<span class='op'>=</span><span class='va'>ids_to</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 2021-03-27 06:27:51 INFO::meltMutations
#&gt; 2021-03-27 06:27:51 INFO::meltMutations
#&gt; 2021-03-27 06:27:51 INFO::computeMunList
#&gt; 2021-03-27 06:27:51 INFO::meltMutations
#&gt; 2021-03-27 06:27:51 INFO::meltMutations
#&gt; 2021-03-27 06:27:51 INFO::computeMunList</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>mapping</span>, <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>mapping</span><span class='op'>$</span><span class='va'>mIdAsNumber.from</span> <span class='op'>!=</span> <span class='va'>mapping</span><span class='op'>$</span><span class='va'>mIdAsNumber.to</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 487</div><div class='input'>
<span class='co'># Communes that are "missing" are mostly lakes and other special communes:</span>
<span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>mapping</span>, <span class='va'>MatchType</span> <span class='op'>==</span> <span class='st'>"missing"</span><span class='op'>)</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"mIdAsNumber.from"</span>, <span class='st'>"mShortName.from"</span><span class='op'>)</span><span class='op'>]</span>
</div><div class='output co'>#&gt;      mIdAsNumber.from          mShortName.from
#&gt; 253              5238 C'za Corticiasca/Valcol.
#&gt; 2222             4510                   Sulgen</div><div class='input'>
<span class='co'># These should be looked at in some detail, and fixed manually:</span>
<span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>mapping</span>, <span class='op'>!</span><span class='op'>(</span><span class='va'>MatchType</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"valid"</span>, <span class='st'>"missing"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;     mHistId.from cAbbreviation.from mId.from
#&gt; 589        11250                 TI     &lt;NA&gt;
#&gt; 590        11251                 TI     &lt;NA&gt;
#&gt;                              mLongName.from          mShortName.from
#&gt; 589 C'za Bidogno/Sala Capriasca/Corticiasca C'za Bid./Sala C./Corti.
#&gt; 590     C'za Sala Capriasca/Vaglio/Lugaggia C'za Sala C./Vag./Lugag.
#&gt;     MatchType.from mHistId.to cAbbreviation.to mId.to mLongName.to
#&gt; 589        missing      14938               TI   5226    Capriasca
#&gt; 590        missing      14938               TI   5226    Capriasca
#&gt;     mShortName.to MatchType.to mIdAsNumber.from mIdAsNumber.to    MatchType
#&gt; 589     Capriasca        valid             5236           5226 missing.from
#&gt; 590     Capriasca        valid             5237           5226 missing.from</div><div class='input'>
<span class='co'># Test for injectivity. The result shows that the mapping is almost injective,</span>
<span class='co'># only one "from" commune is mapped to more than one other "to" commune.</span>
<span class='co'># This situation requires further examination.</span>
<span class='va'>mapping.dupes</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>mapping</span>, <span class='fu'><a href='https://rdrr.io/r/base/duplicated.html'>duplicated</a></span><span class='op'>(</span><span class='va'>mIdAsNumber.from</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>(</span><span class='va'>noninjective.mapping</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span>
  <span class='va'>mapping</span>, <span class='va'>mIdAsNumber.from</span> <span class='op'>%in%</span> <span class='va'>mapping.dupes</span><span class='op'>$</span><span class='va'>mIdAsNumber.from</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;     mHistId.from cAbbreviation.from mId.from mLongName.from mShortName.from
#&gt; 610        11403                 TI     5246       Caneggio        Caneggio
#&gt; 611        11403                 TI     5246       Caneggio        Caneggio
#&gt;     MatchType.from mHistId.to cAbbreviation.to mId.to      mLongName.to
#&gt; 610          valid      14499               TI   5249 Castel San Pietro
#&gt; 611          valid      14974               TI   5269           Breggia
#&gt;         mShortName.to MatchType.to mIdAsNumber.from mIdAsNumber.to MatchType
#&gt; 610 Castel San Pietro        valid             5246           5249     valid
#&gt; 611           Breggia        valid             5246           5269     valid</div><div class='input'>
<span class='co'># Simple treatment (just for this example): Remove duplicates, and use only</span>
<span class='co'># valid matches:</span>
<span class='va'>cleaned.mapping</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>mapping</span>,
                          <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/duplicated.html'>duplicated</a></span><span class='op'>(</span><span class='va'>mIdAsNumber.from</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='va'>MatchType</span> <span class='op'>==</span> <span class='st'>"valid"</span><span class='op'>)</span>

<span class='co'># Now merge the two datasets based on the mapping table:</span>
<span class='va'>SwissPop.1970</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>SwissPop</span>, <span class='va'>Year</span> <span class='op'>==</span> <span class='st'>"1970"</span><span class='op'>)</span>
<span class='va'>SwissPopMapping.1970</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/merge.html'>merge</a></span><span class='op'>(</span><span class='va'>SwissPop.1970</span>,
                              <span class='va'>cleaned.mapping</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"mId.from"</span>, <span class='st'>"mId.to"</span><span class='op'>)</span><span class='op'>]</span>,
                              by.x <span class='op'>=</span> <span class='st'>"MunicipalityID"</span>, by.y <span class='op'>=</span> <span class='st'>"mId.from"</span><span class='op'>)</span>

<span class='co'># Datasets from the "from" table must be suitably aggregated.  For the given</span>
<span class='co'># case of population totals we use the sum.</span>
<span class='va'>SwissPopMapping.1970.agg</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span>
  <span class='va'>SwissPopMapping.1970</span>,
  <span class='va'>mId.to</span>,
  <span class='va'>HouseholdSize</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarize</a></span><span class='op'>(</span>Households <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>Households</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>`summarise()` has grouped output by 'mId.to'. You can override using the `.groups` argument.</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>SwissPopMapping.1970.agg</span>, <span class='fu'><a href='https://rdrr.io/r/base/stopifnot.html'>stopifnot</a></span><span class='op'>(</span>
  <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>mId.to</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>HouseholdSize</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>==</span>
    <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>mId.to</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># The aggregated "from" dataset now can be merged with the "to" dataset:</span>
<span class='va'>SwissBirths.1970</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>SwissBirths</span>, <span class='va'>Year</span> <span class='op'>==</span> <span class='st'>"1970"</span><span class='op'>)</span>
<span class='va'>SwissPopBirths.1970</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/merge.html'>merge</a></span><span class='op'>(</span><span class='va'>SwissPopMapping.1970.agg</span>, <span class='va'>SwissBirths.1970</span>,
                             by.x <span class='op'>=</span> <span class='st'>"mId.to"</span>, by.y <span class='op'>=</span> <span class='st'>"MunicipalityID"</span><span class='op'>)</span>

<span class='co'># Some more communes are still missing from the 1970 statistics, although</span>
<span class='co'># the matches are valid:</span>
<span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>mapping</span>, <span class='va'>mIdAsNumber.to</span> <span class='op'>%in%</span> <span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span>
  <span class='va'>SwissPopMapping.1970.agg</span><span class='op'>$</span><span class='va'>mId.to</span>, <span class='va'>SwissBirths.1970</span><span class='op'>$</span><span class='va'>MunicipalityID</span><span class='op'>)</span><span class='op'>)</span><span class='op'>[</span>,
    <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"mId.from"</span>, <span class='st'>"mShortName.from"</span>, <span class='st'>"MatchType"</span><span class='op'>)</span><span class='op'>]</span>
</div><div class='output co'>#&gt;      mId.from          mShortName.from MatchType
#&gt; 16       3533                Marmorera     valid
#&gt; 30       3503                   Mutten     valid
#&gt; 36       3593                    Duvin     valid
#&gt; 42       3583                  Schnaus     valid
#&gt; 48       3577                    Luven     valid
#&gt; 122      3803                  Braggio     valid
#&gt; 135      3806                    Cauco     valid
#&gt; 146      3743                    Lavin     valid
#&gt; 147      3742                   Guarda     valid
#&gt; 176      3811                    Selma     valid
#&gt; 197      3631                   Almens     valid
#&gt; 198      3616        Waltensburg/Vuorz     valid
#&gt; 217      3711                Rongellen     valid
#&gt; 220      3708                   Mathon     valid
#&gt; 221      3707                Lohn (GR)     valid
#&gt; 222      3706             Innerferrera     valid
#&gt; 226      3702            Ausserferrera     valid
#&gt; 234      3670                   Urmein     valid
#&gt; 235      3669               Tschappina     valid
#&gt; 346      5129                  Sonogno     valid
#&gt; 390      5688                    Syens     valid
#&gt; 439      5732                     Vich     valid
#&gt; 441      5233             Vico Morcote     valid
#&gt; 452      5690         Villars-le-Comte     valid
#&gt; 455      5651     Villars-Sainte-Croix     valid
#&gt; 458      5935           Villars-Epeney     valid
#&gt; 479      3923                  Castiel     valid
#&gt; 549      5650          Vaux-sur-Morges     valid
#&gt; 576      5932                   Ursins     valid
#&gt; 591      5173                  Certara     valid
#&gt; 609      5307      Campo (Vallemaggia)     valid
#&gt; 627      2008           Châtillon (FR)     valid
#&gt; 641      5475      Chavannes-le-Veyron     valid
#&gt; 650      5906                  Chanéaz     valid
#&gt; 720      5668                   Cremin     valid
#&gt; 728      5479                 Cuarnens     valid
#&gt; 816      5102                  Corippo     valid
#&gt; 933      5621                   Aclens     valid
#&gt; 976      6172                   Bister     valid
#&gt; 980      5155                    Bogno     valid
#&gt; 983      4302                  Böbikon     valid
#&gt; 985      5747                 Bofflens     valid
#&gt; 992      5622                Bremblens     valid
#&gt; 999      5096     Brione sopra Minusio     valid
#&gt; 1049     5513           Bioley-Orjulaz     valid
#&gt; 1224     5109                   Gresso     valid
#&gt; 1247     2079               Grangettes     valid
#&gt; 1315     5671           Dompierre (VD)     valid
#&gt; 1427     4106                  Mönthal     valid
#&gt; 1500     5488                   Mauraz     valid
#&gt; 1502     4314                 Mellikon     valid
#&gt; 1503      389                Meienried     valid
#&gt; 1512     5012                   Moleno     valid
#&gt; 1540     6216                 Mex (VS)     valid
#&gt; 1730     6109                    Inden     valid
#&gt; 1800     6178               Martisberg     valid
#&gt; 1803     5676             Martherenges     valid
#&gt; 1872     5315                 Linescio     valid
#&gt; 1911     5564                 Novalles     valid
#&gt; 1964     5798                   Ropraz     valid
#&gt; 2016     5081                   Sobrio     valid
#&gt; 2031     5762                   Sergey     valid
#&gt; 2042     5686                  Sarzens     valid
#&gt; 2167     2216           Pierrafortscha     valid
#&gt; 2372      532                Bangerten     valid
#&gt; 2375      535 Deisswil b. Münchenbuch.     valid
#&gt; 2455      629              Oberhünigen     valid
#&gt; 2464     4084                Islisberg     valid
#&gt; 2467      362                  Ittigen     valid
#&gt; 2468      363            Ostermundigen     valid
#&gt; 2474     6716               Mettembert     valid
#&gt; 2476     3613                   Pigniu     valid
#&gt; 2521     2522                 Hersiwil     valid
#&gt; 2540     4826                  Mammern     valid
#&gt; 2541      631                Trimstein     valid
#&gt; 2542      630             Allmendingen     valid
#&gt; 2550     4643              Bottighofen     valid
#&gt; 2576     2851           Kilchberg (BL)     valid
#&gt; 2805      972                   Berken     valid
#&gt; 2835     4621          Warth-Weiningen     valid
#&gt; 2839     4716               Bettwiesen     valid
#&gt; 2860     6728                 Vellerat     valid
#&gt; 2865     4724                Eschlikon     valid
#&gt; 2881     4786               Wilen (TG)     valid
#&gt; 2887     4546             Schlatt (TG)     valid
#&gt; 2891     4723                  Braunau     valid</div><div class='input'>
<span class='co'># The "from" list must be from an earlier time than the "to" list.</span>
<span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'>swc_get_mapping</span><span class='op'>(</span>ids_from<span class='op'>=</span><span class='va'>ids_to</span>, ids_to<span class='op'>=</span><span class='va'>ids_from</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 2021-03-27 06:27:58 INFO::meltMutations
#&gt; 2021-03-27 06:27:58 INFO::meltMutations
#&gt; 2021-03-27 06:27:58 INFO::computeMunList
#&gt; 2021-03-27 06:27:58 INFO::meltMutations
#&gt; 2021-03-27 06:27:58 INFO::meltMutations
#&gt; 2021-03-27 06:27:58 INFO::computeMunList
#&gt; Error in getMunicipalityMappingWorker(mutations, hist.list.from, mid.from,  : 
#&gt;   mid.from &lt;= mid.to is not TRUE</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Kirill Müller, Tobias Schieferdecker, Thomas Knecht.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


